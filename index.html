<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mental Health Helper</title>
  <style>
    /* ... keep your same CSS styles ... */
    .powered-by {
      text-align: right;
      font-size: 0.9em;
      color: #64748b;
      margin-top: 5px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🧠 Mental Health Helper</h1>
      <p>A safe space to get advice, therapy tips, panic attack help, and track your mood. Not a replacement for therapy.</p>
    </div>

    <!-- Chat Section -->
    <div class="section chat-section">
      <h2>💬 Chat for Advice</h2>
      <div class="input-group">
        <label for="userInput">What's on your mind? (e.g., 'I'm stressed'):</label>
        <input type="text" id="userInput" placeholder="Share your thoughts or concerns..." />
      </div>
      <button class="btn" onclick="getAdvice()">Get Advice</button>
      <div id="messages" class="messages" style="display: none;"></div>
      <div id="poweredBy" class="powered-by" style="display: none;">Powered by Google Gemini AI ✨</div>
    </div>

    <!-- Therapy Tips -->
    <div class="section">
      <h2>🌱 General Therapy & Self-Help Options</h2>
      <div class="expandable">
        <div class="expandable-header" onclick="toggleExpander(this)">
          Click to view general therapy practices ▼
        </div>
        <div class="expandable-content">
         <h3 style="color: #8b5cf6; margin-bottom: 15px;">Evidence-Based Therapeutic Techniques</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #64748b; margin-bottom: 10px;">🧠 Cognitive Behavioral Techniques</h4>
                        <p><strong>• Thought challenging:</strong> Question negative automatic thoughts</p>
                        <p><strong>• Behavioral activation:</strong> Schedule meaningful activities daily</p>
                        <p><strong>• Problem-solving:</strong> Break challenges into manageable steps</p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #64748b; margin-bottom: 10px;">🧘 Mindfulness & Relaxation</h4>
                        <p><strong>• Progressive muscle relaxation:</strong> Tense and release muscle groups</p>
                        <p><strong>• Mindful breathing:</strong> Focus on breath for 5-10 minutes daily</p>
                        <p><strong>• Grounding techniques:</strong> 5-4-3-2-1 sensory method</p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #64748b; margin-bottom: 10px;">💚 Self-Care Strategies</h4>
                        <p><strong>• Sleep hygiene:</strong> Consistent sleep schedule and bedtime routine</p>
                        <p><strong>• Physical activity:</strong> Regular movement to boost mood and energy</p>
                        <p><strong>• Social connection:</strong> Maintain relationships and seek support</p>
                        <p><strong>• Journaling:</strong> Track thoughts, feelings, and patterns</p>
                    </div>

                    <div style="margin-bottom: 10px;">
                        <h4 style="color: #64748b; margin-bottom: 10px;">🆘 Crisis Management</h4>
                        <p><strong>• Safety planning:</strong> Identify warning signs and coping strategies</p>
                        <p><strong>• Support network:</strong> Have emergency contacts readily available</p>
                        <p><strong>• Professional resources:</strong> Know when to seek immediate help</p>
                    </div>
                </div>
            </div>
        </div>
        </div>
      </div>
    </div>

    <!-- Mood Tracking -->
    <div class="section">
      <h2>📊 Track Your Mood</h2>
      <div class="slider-container">
        <label for="moodSlider">How's your mood today? (1 = low, 5 = high)</label>
        <input type="range" id="moodSlider" min="1" max="5" value="3" oninput="updateMoodDisplay()" />
        <div id="moodDisplay" class="mood-display">Mood: 3/5 - 😐 Neutral</div>
      </div>
      <button class="btn" onclick="logMood()">Log Mood</button>
      <div id="moodChart" class="mood-chart" style="display: none;">
        Mood tracking visualization would appear here
      </div>
    </div>

    <div class="footer">
      <p>Prototype v12.1: Now with Gemini-powered backend integration.</p>
    </div>
  </div>

<script>
  let messages = [];
  let moods = [];

  const guides = {
    stress: `😌 Coping with Stress\n\n1. Take short breaks...\n2. Practice deep breathing...`,
    panic: `😮‍💨 Panic/Anxiety Attack Help\n\n1. Remind yourself...`,
    depression: `🌧 When Feeling Low/Depressed\n\n1. Keep a daily routine...`,
    sleep: `🌙 Better Sleep Tips\n\n1. Keep a fixed bedtime...`
  };

  const resources = `📞 Crisis Resources (If You're Struggling)\n- 988 Suicide & Crisis Lifeline...`;

  function generateResponse(userInput) {
    const text = userInput.toLowerCase();
    if (text.includes('panic') || text.includes('anxiety') || text.includes('attack'))
      return guides.panic + "\n\n" + resources;
    if (text.includes('stress') || text.includes('stressed') || text.includes('pressure'))
      return guides.stress;
    if (text.includes('depressed') || text.includes('sad') || text.includes('low') || text.includes('hopeless'))
      return guides.depression + "\n\n" + resources;
    if (text.includes('sleep') || text.includes('insomnia') || text.includes('tired'))
      return guides.sleep;

    return `General wellness tips:\n1. Breathe deeply...\n2. Reach out...\n3. Small self-care...`;
  }

  async function getAdvice() {
    const userInput = document.getElementById('userInput').value.trim();
    if (!userInput) return;

    messages = [];
    messages.push({ role: 'user', content: userInput });

    try {
      const res = await fetch("http://localhost:8502/api/respond", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: userInput })
      });

      if (res.ok) {
        const data = await res.json();
        messages.push({ role: 'ai', content: data.response });
        document.getElementById("poweredBy").style.display = "block"; // Show Gemini tag
      } else {
        throw new Error("Backend error");
      }
    } catch (err) {
      const aiResponse = generateResponse(userInput);
      messages.push({ role: 'ai', content: aiResponse });
      document.getElementById("poweredBy").style.display = "none"; // Hide if fallback
    }

    displayMessages();
    document.getElementById('userInput').value = '';
  }

  function displayMessages() {
    const messagesDiv = document.getElementById('messages');
    messagesDiv.innerHTML = '';
    messagesDiv.style.display = 'block';

    messages.forEach(msg => {
      const div = document.createElement('div');
      div.className = `message ${msg.role}`;
      div.innerHTML = `<div class="message-role">${msg.role === 'user' ? 'You:' : 'AI:'}</div>
                       <div>${msg.content.replace(/\n/g, '<br>')}</div>`;
      messagesDiv.appendChild(div);
    });

    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function updateMoodDisplay() {
    const slider = document.getElementById('moodSlider');
    const display = document.getElementById('moodDisplay');
    const labels = ['😢 Very Low','😔 Low','😐 Neutral','🙂 Good','😊 Great'];
    display.textContent = `Mood: ${slider.value}/5 - ${labels[slider.value - 1]}`;
  }

  function logMood() {
    const moodValue = parseInt(document.getElementById('moodSlider').value);
    const now = new Date();
    moods = [{ date: now.toLocaleString(), mood: moodValue }];

    const chartDiv = document.getElementById('moodChart');
    chartDiv.style.display = 'block';
    chartDiv.innerHTML = `<h3 style="color:#8b5cf6;">Your Latest Mood Log</h3>
                          <p><strong>Date:</strong> ${moods[0].date}</p>
                          <p><strong>Mood:</strong> ${moods[0].mood}/5</p>
                          <div style="font-size:2em;">
                            ${['😢','😔','😐','🙂','😊'][moods[0].mood - 1]}
                          </div>`;
  }

  function toggleExpander(header) {
    const content = header.nextElementSibling;
    if (content.classList.contains('show')) {
      content.classList.remove('show');
      header.innerHTML = header.innerHTML.replace('▲','▼');
    } else {
      content.classList.add('show');
      header.innerHTML = header.innerHTML.replace('▼','▲');
    }
  }

  document.getElementById('userInput').addEventListener('keypress', e => {
    if (e.key === 'Enter') getAdvice();
  });

  updateMoodDisplay();
</script>
</body>
</html>


