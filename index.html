<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mental Health Helper</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #faf6ff;
      margin: 0;
      padding: 0;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      padding: 15px;
      border: 2px solid #b388ff;
      border-radius: 12px;
      background: #fff;
    }

    .header h1 {
      font-size: 2.2em;
      margin: 0;
      color: #7e57c2;
    }

    .header p {
      font-style: italic;
      font-size: 0.95em;
      color: #555;
    }

    .section {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid #e0d7ff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .section h2 {
      margin-top: 0;
      font-size: 1.3em;
      color: #6a1b9a;
    }

    .input-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
    }

    input[type="text"], input[type="range"] {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d1c4e9;
      outline: none;
      font-size: 1em;
    }

    .btn {
      background: linear-gradient(135deg, #7e57c2, #9575cd);
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 25px;
      font-size: 1em;
      cursor: pointer;
      transition: 0.2s;
    }

    .btn:hover {
      background: linear-gradient(135deg, #673ab7, #7e57c2);
    }

    .messages {
      margin-top: 15px;
      padding: 12px;
      border-radius: 12px;
      background: #fafafa;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #e0d7ff;
    }

    .message {
      margin-bottom: 12px;
      padding: 10px;
      border-radius: 8px;
      line-height: 1.4;
    }

    .message.user {
      background: #ede7f6;
      border-left: 4px solid #7e57c2;
    }

    .message.ai {
      background: #f3f0fa;
      border-left: 4px solid #ab47bc;
    }

    .message-role {
      font-weight: bold;
      margin-bottom: 4px;
      color: #4a148c;
    }

    .expander {
      cursor: pointer;
      font-weight: bold;
      color: #6a1b9a;
      margin: 10px 0;
    }

    .expander-content {
      display: none;
      margin-top: 10px;
      background: #f8f6ff;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d1c4e9;
    }

    .footer {
      text-align: center;
      margin-top: 20px;
      font-size: 0.85em;
      color: #777;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üß† Mental Health Helper</h1>
      <p>A safe space to get advice, therapy tips, panic attack help, and track your mood. Not a replacement for therapy.</p>
    </div>

    <!-- Chat Section -->
    <div class="section chat-section">
      <h2>üí¨ Chat for Advice</h2>
      <div class="input-group">
        <label for="userInput">What's on your mind? (e.g., 'I'm stressed'):</label>
        <input type="text" id="userInput" placeholder="Share your thoughts or concerns..." />
      </div>
      <button class="btn" onclick="getAdvice()">Get Advice</button>
      <div id="messages" class="messages" style="display: none;"></div>
    </div>

    <!-- Therapy Tips Section -->
    <div class="section">
      <h2>üå± General Therapy & Self-Help Options</h2>
      <div class="expander" onclick="toggleExpander()">Click to view general therapy practices ‚ñº</div>
      <div id="expanderContent" class="expander-content">
        <ul>
          <li>Practice daily mindfulness or meditation for at least 5 minutes.</li>
          <li>Maintain a balanced sleep schedule to stabilize mood.</li>
          <li>Engage in light physical activity like stretching or walking.</li>
          <li>Write in a gratitude journal before bed.</li>
          <li>Limit caffeine and alcohol to reduce anxiety.</li>
        </ul>
      </div>
    </div>

    <!-- Mood Tracking Section -->
    <div class="section">
      <h2>üìä Track Your Mood</h2>
      <label for="moodRange">How's your mood today? (1 = low, 5 = high)</label>
      <input type="range" id="moodRange" min="1" max="5" value="3" oninput="updateMoodLabel(this.value)" />
      <p id="moodLabel">Mood: 3/5 - üòê Neutral</p>
      <button class="btn" onclick="logMood()">Log Mood</button>
      <div id="moodLogs" style="margin-top: 10px;"></div>
    </div>

    <div class="footer">
      <p>Prototype v13.0: Gemini AI + Fallback + Therapy + Mood Tracker.</p>
    </div>
  </div>

<script>
  let messages = [];
  let moods = [];

  // --- Guides & Crisis Resources ---
  const guides = {
    stress: Stress can feel overwhelming, but it can be managed step by step. Try focusing on deep breathing, breaking tasks into smaller pieces, and taking intentional breaks. Physical exercise and even short walks can help clear your mind and reduce tension.,
    panic: During a panic attack, it‚Äôs important to remind yourself that what you‚Äôre experiencing will pass. Slow your breathing, ground yourself by focusing on physical sensations, and try repeating calming phrases. Regular practice of relaxation techniques can also reduce future panic episodes.,
    depression: Feeling low or depressed can be very heavy, and it‚Äôs okay to acknowledge that. Try expressing yourself through journaling or art, and don‚Äôt hesitate to talk to someone you trust. Remember that small steps like maintaining a routine, going outside for sunlight, or practicing self-compassion can make a difference.,
    sleep: Healthy sleep plays a vital role in mental well-being. To improve sleep, create a calming bedtime routine, avoid screens 1 hour before bed, and keep your sleeping environment quiet and cool. Relaxation practices like meditation or gentle stretching can also prepare your mind for rest.
  };

  const resources = üìû *Crisis Resources*\n- India: 9152987821 (Vandrevala Foundation Helpline)\n- International: Please search your local helpline number.;

  // --- Fallback function ---
  function generateResponse(userInput) {
    const text = userInput.toLowerCase();
    if (text.includes('panic') || text.includes('anxiety') || text.includes('attack')) {
      return guides.panic + "\n\n" + resources;
    } else if (text.includes('stress')) {
      return guides.stress;
    } else if (text.includes('depressed') || text.includes('sad') || text.includes('low')) {
      return guides.depression + "\n\n" + resources;
    } else if (text.includes('sleep') || text.includes('tired')) {
      return guides.sleep;
    } else {
      return It sounds like you may be going through something challenging. A few general tips that often help include staying hydrated, moving your body gently, journaling your thoughts, and connecting with a trusted friend or relative. \n\n${resources};
    }
  }

  // --- Gemini API Call ---
  async function callGemini(prompt) {
    const API_KEY = "YOUR_GEMINI_API_KEY"; // replace with your real API key
    const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=" + API_KEY;

    const body = {
      contents: [
        { role: "user", parts: [{ text: prompt }] }
      ]
    };

    try {
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      if (!res.ok) throw new Error("Gemini request failed");

      const data = await res.json();
      return data.candidates?.[0]?.content?.parts?.[0]?.text || null;
    } catch (err) {
      console.warn("Gemini API error:", err);
      return null;
    }
  }

  // --- Main Advice Function ---
  async function getAdvice() {
    const userInput = document.getElementById('userInput').value.trim();
    if (!userInput) return;

    document.getElementById('userInput').value = '';

    messages = [];
    messages.push({ role: 'user', content: userInput });

    let aiResponse = await callGemini(userInput);

    if (!aiResponse) {
      aiResponse = generateResponse(userInput);
    }

    messages.push({ role: 'ai', content: aiResponse });

    displayMessages();
  }

  // --- Display Chat ---
  function displayMessages() {
    const messagesDiv = document.getElementById('messages');
    messagesDiv.innerHTML = '';
    messagesDiv.style.display = 'block';

    messages.forEach(message => {
      const messageDiv = document.createElement('div');
      messageDiv.className = message ${message.role};

      const roleDiv = document.createElement('div');
      roleDiv.className = 'message-role';
      roleDiv.textContent = message.role === 'user' ? 'You:' : 'AI:';

      const contentDiv = document.createElement('div');
      contentDiv.innerHTML = message.content.replace(/\n/g, '<br>');

      messageDiv.appendChild(roleDiv);
      messageDiv.appendChild(contentDiv);
      messagesDiv.appendChild(messageDiv);
    });

    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  // --- Therapy Expander ---
  function toggleExpander() {
    const content = document.getElementById("expanderContent");
    content.style.display = content.style.display === "block" ? "none" : "block";
  }

  // --- Mood Tracker ---
  function updateMoodLabel(value) {
    const moodText = ["üòû Very Low", "üòî Low", "üòê Neutral", "üòä Good", "üòÅ Very High"];
    document.getElementById("moodLabel").textContent = Mood: ${value}/5 - ${moodText[value-1]};
  }

  function logMood() {
    const moodValue = document.getElementById("moodRange").value;
    const moodText = ["Very Low", "Low", "Neutral", "Good", "Very High"];
    const date = new Date().toLocaleString();
    moods.push({ value: moodValue, text: moodText[moodValue-1], date: date });

    let logsHTML = "<h4>Logged Moods:</h4><ul>";
    moods.forEach(m => {
      logsHTML += <li>${m.date}: ${m.value}/5 - ${m.text}</li>;
    });
    logsHTML += "</ul>";
    document.getElementById("moodLogs").innerHTML = logsHTML;
  }

  // --- Press Enter to Send ---
  document.getElementById('userInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') getAdvice();
  });
</script>
</body>
</html>
